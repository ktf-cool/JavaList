# 线程属性

## 一、中断线程

- 当线程的run方法执行方法体中最后一条语句后再执行return语句返回时，或者出现了方法中没有捕获的异常时，线程将终止，在早期还有一个stop方法，可以用来终止一个线程。但是这个方法已经被废弃了。

> 除了stop方法，interrupt方法可以用来请求终止一个线程。当对一个线程调用interrupt方法时，就会设置线程的中断状态，这是每个线程都有的boolean标志，每个线程都应该不时的检查这个标志，以判断线程是否被中断。

- 要想得出是否设置了中断，首先调用静态的Thread.currentThread方法获得当前线程，然后调用isInterrupted方法：

```
while (!Thread.currentThread().isInterrupted() && more work to do){
	do more work
}
```

> 但是当线程被阻塞就无法检查中断状态，这里就要引入InterruptedException异常。当在一个被sleep或wait调用阻塞的线程上调用interrupt方法时，那个阻塞调用将会被一个InterruptedException异常中断。

- 中断一个线程只是要引起它的注意，被中断的线程可以决定如何响应中断。某些线程非常重要，应该处理这个异常。但是跟普遍的是线程只希望将中断解释为一个终止请求，这种线程的run方法如下：

```
Runnable r = () -> {
	try {
		...
		while(!Thread.currentThread().isInterrupted() && more work to do){
			do more work
		}
	} catch (InterruptedException e){
		//thread was interrupted during sleep or wait
	} finally{
		cleanup, if required
	}
	//exiting the run method terminates the thread
};
```

- 如果你的线程调用了sleep方法，就不要检测中断状态，而应当捕获`InterruptedException`异常。

```
Runnable r = () -> {
	try {
		...
		while(more work to do){
			do more work
			Thread.sleep(delay);
		}
	} catch (InterruptedException e){
		//thread was interrupted during sleep or wait
	} finally{
		cleanup, if required
	}
	//exiting the run method terminates the thread
};
```

> 这两个方法非常类似，interrupted和isInterrupted。interrupted方法是一个静态方法，检查当前线程是否被中断，而且会清除该线程的中断状态。isInterrupted是一个实例方法，可以用来检测是否有线程被中断，不会改变中断状态。

## 二、守护线程

- 可以通过 `t.setDaemon(true);` 将一个线程转换为守护线程，守护线程的唯一用途是为其他线程提供服务。计时器就是一个例子。当只剩下守护线程，就没必要继续运行程序了。

## 三、线程名

- 默认情况下，线程有容易记的名字，如 Thread-1，可以用setName方法为线程设置任何名字;

```
var t = new Thread(runnable);
t.setName("Web crawler");   //在线程转储时可能很有用
```

## 四、未捕获异常处理器

- 线程的run方法不能抛出任何检查型异常，但是非检查型异常可能会导致线程终止，这种情况下，线程会死亡。在线程死亡之前，异常会传递到一个用于处理为捕获异常的处理器。

> 这个处理器必须属于实现了`Thread.UncatchExceptionHandler`接口的类。这个接口只有一个方法：

```
void uncatchException(Thread t, Throwable e)
```

> 可以用setUncaugthExceptionHandler方法为任何线程安装一个处理器。也可以使用Thread类的静态方法setDefaultUncatchExceptionHandler为所有线程安装一个默认的处理器。如果没有安装默认处理器，默认处理器则为null,如果没有为单个线程安装处理器，那么 处理器就是该线程的ThreadGroup对象。



## 五、线程优先级

- java中每一个线程都有一个优先级，默认情况下一个线程会继承构造它的那个线程的优先级，可以用setPriority方法提高或降低任何一个线程的优先级。

> 现在不要使用线程优先级了。