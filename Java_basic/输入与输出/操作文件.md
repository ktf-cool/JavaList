# 操作文件



## 一、Path

- `Path`(路径)表示的是一个目录名序列，其后还可以跟着一个文件名。

> 路径中的第一个部件可以是根部件，如 / 或 C:\  ,而允许访问的根路径取决于文件系统。

- 以根路径开始的路径是绝对路径，否则就是相对路径。创建一个绝对路径和相对路径：

```java
Path absolute = Paths.get("/home", "harry");
Path realative = Paths.get("myprog", "conf", "user.properties");
```

> 静态的`Path.get`方法接受一个或多个字符串，并将它们用默认文件系统的路径分隔符连接起来。解析连起来的结果，如果其表示的不是系统中的合法路径，就抛出`InvalidPathException`异常。这个连接起来的结果就是一个`Path`对象。

- `get`方法可以获取包含多个部件的单个字符串，例如，可以像下面这样从配置文件中读取路径：

```java
String baseDir = props.getProperty("base.dir");
Path basePath = Paths.get(baseDir);
```

> 路径不必对应着某个实际存在的文件，它仅仅是一个抽象的名字序列。当想要创建文件时，首先要创建一个路径，然后才调用方法去创建对应的文件。

- [ ] 组合或解析一个路径是常见的操作，调用 `p.resolve(q)` 将按照下列规则返回一个路径：

- 如果`q`是绝对路径，结果就是`q` .
- 否则，根据文件系统的规则，将 `p` 后面跟着 `q` 作为结果。

> `resolve`方法有一种快捷方式，接受一个字符串而不是路径：

```java
Path workPath = basePath.resolve("work");
```

- 还有一个很方便的`resolveSibling`，通过解析指定路径的父路径产生其兄弟路径。如果`workPath` 是 `/opt/myapp/work`, 那么下面的调用：

```java
Path tempPath = workPath.resolveSibling("temp");
```

> 将创建 `/opt/myapp/temp`。

- `resolve` 的对立面的`relativize`,即调用`p.relaticize(r)` 将产生路径`q`,而对`q`进行解析的结果证实`r`;

- `normalize`方法将移除所有的冗余的 `.`  和  `..`  部件（或者文件系统认为冗余的所有部件）。

- `toAbsolutePath`方法将产生给定路径的绝对路径，该绝对路径从根部件开始。

- `Path` 类有许多有用的方法用来将路径断开：

```java
Path p = Paths.get("/home", "fred", "myprog.properties");
Path parent = p.getParent();
Path file = p.getFileName();
Path root = p.getRoot();
```

- 还可以重`Path`中构建`Scanner`对象：

```java
var in = new Scanner("Paths.get("/home/fred/input.txt"));
```



## 二、读写文件

- Files类可以使得普通文件操作变得快捷。例如：用下面的方式可以很容易地读取文件的所有内容：

```java
byte[] bytes = Files.readAllBytes(path);
```

- 可以从文本文件中读取内容：

```java
var content = Files.resdString(path, charset);
```

- 如果将文件当做序列读入，那么可以调用：

```java
List<String> lines = Files.resdAllLines(path, charset);
```

- 如果希望写出一个字符串到文件中，可以调用：

```java
Files.writeString(path, content, charset);
```

- 向指定文件追加内容可以调用：

```java
Files.write(path, content.getBytes(charset), StandardOption.APPEND);
```

- 将一个行的集合写出到文件中：

```java
Files.write(path, lines, charset);
```

> 这些简便方法适合处理中等长度的文本文件，如果要处理的文本文件长度比较大，或者是二进制文件，那么还是应该使用所熟知的输入/输出流或者读入器/写出器：

```java
InputStream in = Files.newInputStream(path);
OutputStream out = Files.newOutputStream(path);
Reader in = Files.newBufferedReader(path, charset);
Write out = Files.newBufferedWriter(path, charset);
```



## 三、创建文件和目录

- 创建新目录可以调用

```
Files.createDirectory(path);
```

> 其中，路径中除最后一个部件外，其他部分时必须已存在的。

- 要创建路径中的中间目录可以使用：

```java
Files.createDirectories(path);
```

- 可以使用下面的语句创建一个空文件：

```
Files.createFile(path);
```

> 如果文件已经存在，那么这个调用就会抛出异常。

- 检查文件是否存在和创建文件是原子性的，如果文件不存在，改文件就会被创建，且其他程序在此过程中，是无法执行文件创建操作的。
- 有些便捷方法可以用来在给定位置或系统指定位置创建临时文件或临时目录：

```java
Path newPath = Files.createTempFile(dir, prefix, suffix);
Path newPath = Files.createTempFile(prefix, suffix);
Path newPath = Files.createTempDirectory(dir, prefix);
Path newPath = Files.createTempDirectory(prefix);
```

> 其中，`dir` 是一个`Path`对象，`prefix` 和 `suffix` 是可以为`null`的字符串。



## 四、复制、移动和删除文件

- 将文件从一个位置复制到另一个位置可以直接调用：

```java
Files.copy(fromPath, toPath);
```

- 移动文件（即复制并删除原文件）可以调用：

```java
Files.move(fromPath, toPath);
```

> 如果目标路径已经存在，那么复制或移动将失败。如果想要覆盖已有的目标路径，可以使用`REPLACE_EXISTING`选项。如果想要复制文件的属性，可以使用`COPY_ATTRIBUTES`选项。可以像下面这样同时选择这两个选项：

```java
Files.copy(fromPath, toPath, StandardCopyOption.REPLACE_EXISTING, 		          		StandardCopyOption.COPY_ATTRIBUTES);
```

- 可以将移动操作定义为原子性的，可以保证要移动操作成功完成，要么源文件继续保持在原来位置。具体可以使用`ATOMIC_MOVE`选项来实现：

```java
Files.move(fromPath, toPath, StandardCopyOption.ATOMIC_MOVE);
```

- 可以将一个输入流复制到`Path`中，这表示想要将该输入流存储到硬盘上。可以将一个`Path`复制到输出流中。可以使用下面的调用：

```java
Files.copy(inputStream, toPath);
Files.copy(fromPath, outputStream);
```

- 删除文件可以调用：

```
Files.delete(path);
```

> 如果删除的文件不存在，这个方法就会抛出异常，可使用下面的方法：

```
boolean deleted = Files.deleteIfExists(path);
```

> 该删除方法还可以用来移除空目录。



## 五、获取文件信息

- [ ] 下面的静态方法都将返回一个boolean值，表示检查路径的某个属性的结果：

- `exists`
- `isHidden`
- `isReadable`, `isWritable`, `isExecutable`
- `isRegularFile`, `isDirectory`, `isSysbolicLink`

size 方法将返回文件的字节数：

```
long fileSize = Files.size(path);
```

`getOwner`方法将文件的拥有者作为`java.nio.file.attribute.UserPrincipal`的一个实例返回。

所有文件系统都会报告一个基本属性集，它们被封装在`BasicFileAttributes`接口中，这些属性与上述信息有部分重叠。基本文件属性包括：

- 创建文件、最后一次访问以及最后一次修改文件的时间，这些时候都表示成`java.nio.file.attribute.FileTime`。

- 文件是常规文件、目录还是符号链接，抑或这三者都不是。
- 文件尺寸。
- 文件主键，这是某些类的对象，具体所属类与文件系统相关，有可能是文件的唯一标识符，也可能不是。

要获取这些属性，可以调用

```java
BasicFileAttributes attributes = Files.readAttributes(path, BasicFileAttributes.class);
```



## 六、访问目录中的项

- 静态的`Files.lis`t方法会返回一个可以读取目录中各个项的`Stream<Path>` 对象。
- 读取目录涉及需要关闭的系统资源，应该使用`try`块：

```
try(Stream<Path> entries = Files.list(pathToDirectory)) {
	...
}
```

- `list` 方法不会进入子目录，为了处理目录中的所有子目录，需要使用 `File.walk`方法。

```java
try (Stream<Path> entries = Files.walk(pathToRoot)){
	// Contains all descendants, visited in depth-first order
}
```

