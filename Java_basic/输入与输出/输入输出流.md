# 输入/输出流

## 一、读写字节

- `InputStream`类有一个抽象方法：

```java
abstract int read()
```

> 这个方法将读入一个字节，并返回读入的字节，或者在遇到输入源结尾时返回-1。

- `InputStream`类还有若干个非抽象的方法，可以读入一个字节数组，或者跳过大量的字节。

> `Java9`开始，有一个可以读取流中所有字节的方法：

```java
byte[] bytes = in.readAllBytes();
```

- `OutputStream`类定义了下面的抽象方法：

```java
abstract void = write(int b)
```

> 它可以向某个输出位置写出一个字节。

- 如果我们有一个字节数组，可以一次性的写出它们：

```java
byte[] values = ... ;
out.write(values);
```

- `transferTo`方法可以将所有字符从一个输入流传递到一个输出流：

```java
in.transferTo(out);
```

- `read`和`write`方法在执行时都将阻塞，知道字节确实被读入或写出。
- `available`方法可以检查当前可读入的字节数量，像下面这样的代码片段不可能被阻塞：

```java
int bytesAvailable = in.available();
if(bytesAvailable > 0) {
	var data = new byte[bytesAvailable];
	in.read(data);
}
```

> 当你完成对输入/输出流的读写时，可以通过调用close方法来关闭它。

- 关闭一个输出流的同时会冲刷用于该输出流的缓冲区：所有被临时置于缓冲区中，以便用更大的包的形式传递的字节在关闭输出流时都将被送出。如果不关闭文件，写出字节最后一个包可能永远也得不到传递。
- 可以使用`flush`方法来人为地冲刷这些输出。



## 二、完整的流家族

![](D:\java笔记\Java脑图\输入流与输出流的层次结构.png)

![](D:\java笔记\Java脑图\Reader和Writer的层次结构.png)

![](D:\java笔记\Java脑图\Closeable等接口.png)

> `InputStream`、`OutputStream`、`Reader` 和 `Writer` 都实现了`Closeable`接口。



## 三、组合输入/输出流过滤器

- `FileInputStream`和`FileOutputStream`可以提供附着在一个磁盘文件上的输入流和输出流，向构造器提供文件名或文件的绝对路径。例如：

```java
var fin = new FileInputStream("employee.dat");
```

> 这行代码可以查看用户目录下名为 "`employee.dat`" 的文件。所有在`java.io`中的类都将相对路径名解释以用户工作目录开始。

- 与抽象类`InputStream`和`OutputStream`一样，这些类只支持在字节级别上的读写。

```java
byte b = (byte) fin.read();
```

- 如果只有`DataInputStream`，那么就只能读入数字类型：

```java
DataInputStream din = ... ;
double x = din.readDouble();
```

> `DataInputStream`没有从文件中获取数据的方法。

- 从文件中读取数字，需要创建一个`FileInputStream`,然后将其传递给`DataInputStream`的构造器：

```java
var fin = new FileInputStream("employee.dat");
var din = new DataInputStream(fin);
double x = din.readDouble();
```

- 可以通过嵌套过滤器来添加多重功能。例如：想使用缓冲机制和用于数据的传入方法，那么就需要使用下面这种复杂的构造器序列：

```java
var din = new DataInputStream(
	new BufferedInputStream(
		new FileInputStream("employee.dat")));
```

> 把`DataInputStream`置于构造器链的最后，这是希望使用`DataInputStream`方法，希望使用带缓冲机制的`read`方法。

- 当多个输入流连接在一起时，需要跟踪各个中介输入流。
- 当读入输入时，需要预览下一个字节，以了解它是否是你想要的值，Java提供了用于此目的的`PushbackInputStream`：

```java
var pbin = new PushbackInputStream(
	new BufferedInputStream(
		new FileInputStream("employee.dat")));
```

可以预读下一个字节：

```java
int b = pbin.read();
```

在它并非所期望的值时将其推回流中。

```java
if(b != '<') pbin.read();
```

> 但是读入和推出是可应用于可回推输入流的仅有方法。

- 如果你希望能够预先浏览并且还可以读入数字，那么需要一个既是可回推流，又是一个数据输入流的引用。

```java
var din = new DataInputStream(
	pbin = new PushbackInputStream(
		new BufferedInputStream(
			new FileInputStream("employee.dat"))));
```



## 四、文本输入与输出

- 保存数据时，可以选择二进制格式或文本格式。在存储文本字符串时，需要考虑字符编码方式。
- `OutputStreamWriter`类将使用选定的字符编码方式，把Unicode码元的输出流转换为字节流。而`InputStreamReader`类将包含字节（使用某种字符编码方式表示的字符）的输入流转换为可以产生Unicode码元的读入器。
- Reader和Writer类都只有读入和写出单个字符的基础方法，在使用流时，可以使用处理字符串和数字的子类。
- 对于文本输出，可以使用`PrintWriter`。这个类拥有以文本格式打印字符串和数字的方法。

```java
var out = new PrintWriter("employee.txt",StandardCharsets.UTF_8);
```

> 为输出到打印写出器，需要使用与使用`System.out`时相同的print、`println` 和 `printf`方法。

- 如果写出器设置为自动冲刷模式，那么只要`println`被调用，缓冲区中的所有字符都会被发送到它们的目的地（打印写出器总是带缓冲区的）。默认情况下，自动冲刷机制是禁用的，可以用过使用`PrintWrite(Writer writer, boolean antoFlush)`来启用或禁用自动冲刷机制。

```java
var out = new PrintWriter(
	new OutputStreamWriter(
		new FileOutputStream("employee.txt"),StandardCharsets.UTF_8),
	true);   // autoflush
```

> print方法不抛出异常，可以调用`checkError`方法来查看输出流是否出现了某些错误。

- 最简单的处理任意文本的方式就是使用`Scanner`类，可以从输入流中构建`Scanner`对象。

- 可以将短小的文本文件读入到一个字符串中：

```java
var content = (Files.read String path, charset);
```

> 如果文件过大，可以将行惰性处理为一个`Stream<String>` 对象：

```java
try(Stream<String> lines = Files.lines(path, charset))
{
	...
}
```

- 可以使用扫描器来读入符号，即由分隔符分隔的字符串，默认的分隔符是空白字符，可以将分隔符修改为任意的正则表达式。

```java
Scanner in = ... ;
in.useDelimiter("\\PL+");
```

> 将接受任何非`Unicode`字母作为分隔符。之后，这个扫描器将只接受`Unicode`字母。