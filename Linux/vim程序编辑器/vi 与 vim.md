# vi 与 vim

## 一、为何要学 vim

- 在所有的 `Linux distributions` 上头都会有的一套文书编辑器就是 `vi` ，而且很多软件默认也是使用 `vi` 做为他们编辑的接口。

- 所有的 `Unix Like` 系统都会内置 `vi` 文书编辑器，其他的文书编辑器则不一定会存在；
- 很多个别软件的编辑接口都会主动调用 `vi` （例如未来会谈到的 `crontab`, `visudo`, `edquota`
  等指令）；
- vim 具有程序编辑的能力，可以主动的以字体颜色辨别语法的正确性，方便程序设计；
- 因为程序简单，编辑速度相当快速。

> `vim` 视作 `vi` 的进阶版本，`vim` 可以用颜色或底线等方式来显示一些特殊的信息,还能够进行诸如 `shell script`, `C program` 等程序编辑功能。



## 二、vi 的使用

- [ ] `vi` 共分为三种模式，分别是“一般指令模式”、“编辑模式”与“命令行命令模式”。

- 一般指令模式 `（command mode）`

以 `vi` 打开一个文件就直接进入一般指令模式了（这是默认的模式，也简称为一般模式）。在这个模式中， 可以使用“上下左右”按键来移动光标，可以使用“删除字符”或“删除整列”来处理文件内容， 也可以使用“复制、贴上”来处理文件数据。

- 编辑模式 `（insert mode）`

在一般指令模式中可以进行删除、复制、贴上等等的动作，但是却无法编辑文件内容的！ 要等到你按下“`i, I, o, O, a, A, r, R`”等任何一个字母之后才会进入编辑模式。注意了！通常在Linux 中，按下这些按键时，在画面的左下方会出现“ `INSERT` 或 `REPLACE` ”的字样，此时才可以进行编辑。而如果要回到一般指令模式时， 则必须要按下“`Esc`”这个按键即可退出编辑模式。

- 命令行命令模式 `（command-line mode）`

在一般模式当中，输入“ `: / ?` ”三个中的任何一个按钮，就可以将光标移动到最下面那一列。在这个模式当中， 可以提供“搜寻数据”的动作，而读取、存盘、大量取代字符、离开 `vi` 、显示行号等等的动作则是在此模式中达成的！

> 简单的说，我们可以将这三个模式想成下面的图示来表示：

![iamge](https://github.com/ktf-cool/JavaList/blob/master/images/vi%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%9B%B8%E4%BA%92%E5%85%B3%E7%B3%BB.png)

> 一般指令模式可与编辑模式及命令行界面切换， 但编辑模式与命令行界面之间不可互相切换。

- 使用“ `vi filename` ”进入一般指令模式

```
# 使用 vi 来创建一个名为 welcome.txt 的文件：
[dmtsai@study ~]$ /bin/vi welcome.txt
# 在 CentOS 7 当中，由于一般帐号默认 vi 已经被 vim 取代了，因此得要输入绝对路径来执行才行！
```

> `vi` 后面一定要加文件名，不管该文件名存在与否。

- 按下 `i` 进入编辑模式，开始编辑文字

在一般指令模式之中，只要按下 `i, o, a` 等字符就可以进入编辑模式了！在编辑模式当中，可以发现在左下角状态列中会出现 `–INSERT-` 的字样，那就是可以输入任意字符的提示啰！这个时候，键盘上除了 `[Esc]` 这个按键之外，其他的按键都可以视作为一般的输入按钮了，所以可以进行任何的编辑。

- 按下 `[ESC`] 按钮回到一般指令模式

按下 `[Esc]` 这个按钮即可发现画面左下角的 – INSERT – 不见了。

- 进入命令行界面，文件储存并离开 `vi` 环境

存盘 （`write`） 并离开 （`quit`） 的指令很简单，输入“`:wq`”即可存盘离开！ （注意了，按下 `:` 该光标就会移动到最下面一列去！）

- [ ] 按键说明

- 第一部份：一般指令模式可用的按钮说明，光标移动、复制贴上、搜寻取代等。

| 移动光标的方法          | 作用                                                         |
| ----------------------- | ------------------------------------------------------------ |
| h 或 向左方向键（←）    | 光标向左移动一个字符                                         |
| j 或 向下方向键（↓）    | 光标向下移动一个字符                                         |
| k 或 向上方向键（↑）    | 光标向上移动一个字符                                         |
| l 或 向右方向键（→）    | 光标向右移动一个字符                                         |
| `[Ctrl] + [f]`          | 屏幕“向下”移动一页，相当于 `[Page Down]`按键 （常用）        |
| `[Ctrl] + [b]`          | 屏幕“向上”移动一页，相当于 `[Page Up]` 按键（常用）          |
| `[Ctrl] + [d]`          | 屏幕“向下”移动半页                                           |
| `[Ctrl] + [u]`          | 屏幕“向上”移动半页                                           |
| `+`                     | 光标移动到非空白字符的下一列                                 |
| `-`                     | 光标移动到非空白字符的上一列                                 |
| `n<space>`              | 那个 `n` 表示“数字”，例如 `20` 。按下数字后再按空白键，光标会向右移动这一列的 `n` 个字符。 |
| `0` 或功能键`[Home]`    | 这是数字“ `0` ”：移动到这一列的最前面字符处（常用）          |
| `$` 或功能键`[End]`     | 移动到这一列的最后面字符处（常用）                           |
| `H`                     | 光标移动到这个屏幕的最上方那一列的第一个字符                 |
| `M`                     | 光标移动到这个屏幕的中央那一列的第一个字符                   |
| `L`                     | 光标移动到这个屏幕的最下方那一列的第一个字符                 |
| `G`                     | 移动到这个文件的最后一列（常用）                             |
| `gg`                    | 移动到这个文件的第一列，相当于 `1G` （常用）                 |
| `n<Enter>`              | `n` 为数字。光标向下移动 n 列（常用）                        |
| `/word`                 | 向光标之下寻找一个名称为 `word` 的字串。                     |
| `:n1,n2s/word1/word2/g` | `n1` 与 `n2` 为数字。在第 `n1` 与 `n2` 列之间寻找`word1` 这个字串，并将该字串取代为 `word2`！举例来说，在 `100` 到 `200` 列之间搜寻 `vbird`并取代为 `VBIRD`则：“`:100,200s/vbird/VBIRD/g`”。（常用） |
| `:1,$s/word1/word2/g`   | 从第一列到最后一列寻找 `word1` 字串，并将该字串取代为 `word2` ！（常用） |
| `:1,$s/word1/word2/gc`  | 从第一列到最后一列寻找 `word1` 字串，并将该字串取代为 `word2` ！且在取代前显示提示字符给使用者确认 （`confirm`） 是否需要取代！（常用） |
| `x, X`                  | 在一列字当中，x 为向后删除一个字符 （相当于 [`del`] 按键）， X 为向前删除一个字符（相当于 [`backspace`] 亦即是倒退键） （常用） |
| `nx`                    | `n` 为数字，连续向后删除 `n` 个字符。举例来说，我要连续删除 `10` 个字符， “`10x`”。 |
| `dd`                    | 删除光标所在的那一整列（常用）                               |
| `ndd`                   | n 为数字。删除光标所在的向下 n 列，例如`20dd` 则是删除 20 列 （常用） |
| `d1G`                   | 删除光标所在到第一列的所有数据                               |
| `dG`                    | 删除光标所在到最后一列的所有数据                             |
| `d$`                    | 删除光标所在处，到该列的最后一个字符                         |
| `d0`                    | 那个是数字的 0 ，删除光标所在处，到该列的最前面一个字符      |
| `yy`                    | 复制光标所在的那一列（常用)                                  |
| `nyy`                   | `n` 为数字。复制光标所在的向下 `n` 列，例如`20yy` 则是复制 `20` 列（常用） |
| `y1G`                   | 复制光标所在列到第一列的所有数据                             |
| `yG`                    | 复制光标所在列到最后一列的所有数据                           |
| `y0`                    | 复制光标所在的那个字符到该列行首的所有数据                   |
| `y$`                    | 复制光标所在的那个字符到该列行尾的所有数据                   |
| `p, P`                  | `p` 为将已复制的数据在光标下一列贴上，`P` 则为贴在光标上一列！ 举例来说，我目前光标在第 `20` 列，且已经复制了 `10` 列数据。则按下 `p` 后， 那 `10` 列数据会贴在原本的 `20` 列之后，亦即由 `21` 列开始贴。但如果是按下 `P`呢？ 那么原本的第 `20` 列会被推到变成 `30`列。 （常用） |
| `J`                     | 将光标所在列与下一列的数据结合成同一列                       |
| `c`                     | 重复删除多个数据，例如向下删除 `10` 列，[`10cj` ]            |
| `u`                     | 复原前一个动作。（常用）                                     |
| `[Ctrl]+r`              | 重做上一个动作。（常用）                                     |

- 第二部份：一般指令模式切换到编辑模式的可用的按钮说明。

| 进入插入或取代的编辑模式 | 作用                                                         |
| ------------------------ | ------------------------------------------------------------ |
| `i, I`                   | 进入插入模式`（Insert mode）`：`i`为“从目前光标所在处插入”， `I`为“在目前所在列的第一个非空白字符处开始插入”。 （常用） |
| `a, A`                   | 进入插入模式（`Insert mode`）：`a`为“从目前光标所在的下一个字符处开始插入”， `A` 为“从光标所在列的最后一个字符处开始插入”。（常用） |
| `o, O`                   | 进入插入模式（`Insert mode`）：这是英文字母 `o` 的大小写。`o`为“在目前光标所在的下一列处插入新的一列”； `O` 为在目前光标所在处的上一列插入新的一列！（常用） |
| `r, R`                   | 进入取代模式（`Replacemode`）：`r` 只会取代光标所在的那一个字符一次；R会一直取代光标所在的文字，直到按下 `ESC` 为<止；（常用） |
| `[Esc]`                  | 退出编辑模式，回到一般指令模式中（常用）                     |

- 第三部份：一般指令模式切换到命令行界面的可用按钮说明

| 命令行界面的储存、离开等指令 | 作用                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| `:w`                         | 将编辑的数据写入硬盘文件中（常用）                           |
| `:w!`                        | 若文件属性为“只读”时，强制写入该文件。不过，到底能不能写入， 还是跟你对该文件的文件权限有关啊！ |
| `:q`                         | 离开 vi （常用）                                             |
| `:q!`                        | 若曾修改过文件，又不想储存，使用 ! 为强制离开不储存盘案。    |
| `:wq`                        | 储存后离开，若为 `:wq!` 则为强制储存后离开 （常用）          |
| `ZZ`                         | 这是大写的 Z 喔！若文件没有更动，则不储存离开，若文件已经被更动过，则储存后离开！ |
| `:w [filename]`              | 将编辑的数据储存成另一个文件（类似另存新文件）               |
| `:r [filename]`              | 在编辑的数据中，读入另一个文件的数据。亦即将“filename” 这个文件内容加到光标所在列后面 |
| `:n1,n2 w [filename]`        | 将 `n1` 到 `n2` 的内容储存成 filename 这个文件。             |
| `:! command`                 | 暂时离开 vi 到命令行界面下执行 command 的显示结果！例如 “`:! ls /home`”即可在 `vi` 当中察看 `/home` 下面以`ls` 输出的文件信息！ |
| `vim` 环境的变更             |                                                              |
| `:set nu`                    | 显示行号，设置之后，会在每一列的字首显示该列的行号           |
| `:set nonu`                  | 与 `set nu` 相反，为取消行号！                               |



## 三、vim 的暂存盘、救援回复与打开时的警告讯息

- 主要的文书编辑软件都会有“回复”的功能，亦即当你的系统因为某些原因而导致类似死机的情况时， 还可以通过某些特别的机制来让你将之前未储存的数据“救”回来！`vim` 就是通过“暂存盘”来救援的。
- 当我们在使用 `vim` 编辑时， `vim` 会在与被编辑的文件的目录下，再创建一个名为`.filename.swp` 的文件。
- 问题一：可能有其他人或程序同时在编辑这个文件：

```
由于 Linux 是多用户多任务的环境，因此很可能有很多人同时在编辑同一个文件。如果在多人共同编辑的情况下， 万一大家同时储存，那么这个文件的内容将会变的乱七八糟！为了避免这个问题，因此 vim 会出现这个警告窗口！ 解决的方法则是：
 1. 找到另外那个程序或人员，请他将该 vim 的工作结束，然后你再继续处理。
 2. 如果你只是要看该文件的内容并不会有任何修改编辑的行为，那么可以选择打开成为只读（O）文件， 亦即上述画面反白部分输入英文“ o ”即可，其实就是 [O]penRead-Only 的选项啦！
```

- 问题二：在前一个 `vim` 的环境中，可能因为某些不知名原因导致 `vim` 中断（`crashed`）：

```
1. 如果你之前的 vim 处理动作尚未储存，此时你应该要按下“R”，亦即使用 （R）ecover 的项目， 此时 vim 会载入 .man_db.conf.swp 的内容，让你自己来决定要不要储存！这样就能够救回来你之前未储存的工作。 不过那个 .man_db.conf.swp 并不会在你结束 vim 后自动删除，所以你离开 vim 后还得要自行删除.man_db.conf.swp 才能避免每次打开这个文件都会出现这样的警告！

2. 如果你确定这个暂存盘是没有用的，那么你可以直接按下“D”删除掉这个暂存盘，亦即 （D）elete it 这个项目即可。 此时 vim 会载入 man_db.conf ，并且将旧的.man_db.conf.swp 删除后，创建这次会使用的新的 .man_db.conf.swp 喔！
```

- 暂存盘警告讯息的画面中，有出现六个可用按钮，各按钮的说明如下：

> 1. `[O]pen Read-Only`：打开此文件成为只读文件， 可以用在你只是想要查阅该文件内容并不想要进行编辑行为  时。
> 2. `（E）dit anyway`：还是用正常的方式打开你要编辑的那个文件， 并不会载入暂存盘的内容。不过很容易出现两个使用者互相改变对方的文件等问题！
> 3. `（R）ecover`：就是载入暂存盘的内容，用在你要救回之前未储存的工作。 不过当你救回来并且储存离开 vim 后，还是要手动自行删除那个暂存盘喔！
> 4. `（D）elete it`：你确定那个暂存盘是无用的！那么打开文件前会先将这个暂存盘删除！
> 5. `（Q）uit`：按下 q 就离开 `vim` ，不会进行任何动作回到命令提示字符。
> 6. `（A）bort`：忽略这个编辑行为，感觉上与 `quit` 非常类似！ 也会送你回到命令提示字符就是啰！
