# 使用`MySQL`正则表达式



## 一、基本字符匹配

- 下面的例子：

```mysql
SELECT prod_name FROM products WHERE prod_name REGEXP '1000' ORDER BY prod_name;
```

> 关键字`LIKE`被`REGEXP`替代,它告诉`MySQL：REGEXP`后所跟的东西作为正则表达式（与文字正文1000匹配的一个正则表达式）处理。

```my
SELECT prod_name FROM products WHERE prod_name REGEXP '.000' ORDER BY prod_name;
```

> 使用了正则表达式`.000`。`.`是正则表达式语言中一个特殊的字符。它表示匹配任意一个字符。

- 在`LIKE`和`REGEXP`之间有一个重要的差别。请看以下两条语句：

```mysql
SELECT prod_name FROM products WHERE prod_name LIKE '1000' ORDER BY prod_name;

SELECT prod_name FROM products WHERE prod_name REGEXP '1000' ORDER BY prod_name;
```

> 第一条语句不返回数据，而第二条语句返回一行。`LIKE`匹配整个列。如果被匹配的文本在列值中出现，LIKE将不会找到它，相应的行也不被返回（除非使用通配符）。而`REGEXP`在列值内进行匹配，如果被匹配的文本在列值中出现，`REGEXP`将会找到它，相应的行将被返回。



## 二、进行OR匹配

- 为搜索两个串之一（或者为这个串，或者为另一个串），使用|，如下所示：

```mysql
SELECT prod_name FROM products WHERE prod_name REGEXP '1000 | 2000' ORDER BY prod_name;
```

> `|`为正则表达式的`OR`操作符。它表示匹配其中之一，可以给出两个以上的`OR`条件。例如，`'1000 | 2000 | 3000`。



## 三、匹配几个字符之一

- 可通过指定一组用[和]括起来的字符来想匹配特定的字符。如下所示：

```mysql
SELECT prod_name FROM products WHERE prod_name REGEXP '[123] Ton' ORDER BY PROD_name;
```

> 使用了正则表达式`[123] Ton`。`[123]`定义一组字符，它的意思是匹配`1`或`2`或`3`，因此，`1 ton`和`2 ton`都匹配且返回。

- `[ ]`是另一种形式的`OR`语句。事实上，正则表达式`[123]Ton`为`[1|2|3]Ton`的缩写，

- 字符集合也可以被否定，即，它们将匹配除指定字符外的任何东西。为否定一个字符集，在集合的开始处放置一个`^`即可



## 四、匹配范围

- 集合可用来定义要匹配的一个或多个字符。例如，下面的集合将匹配数字`0`到`9`：

```
[0123456789]
```

> 为简化这种类型的集合，可使用-来定义一个范围:

```
[0-9]
```

> 范围不限于完整的集合，`[1-3]`和`[6-9]`也是合法的范围。此外，范围不一定只是数值的，`[a-z]`匹配任意字母字符。



## 五、匹配特殊字符

- 例如，如果要找出包含`.`字符的值：

```mysql
SELECT vend_name FROM vendors WHERE vend_name REGEXP '.' ORDER BY vend_name;
```

> 这并不是有期望的输出，`.`匹配任意字符，因此每个行都被检索出来。

- 为了匹配特殊字符，必须用`\\`为前导。`\\-`表示查找`-`，`\\.`表示查找`.`。

```mysql
SELECT vend_name FROM vendors WHERE vend_name REGEXP '\\.' ORDER BY vend_name;
```

> 。\\.匹配.，所以只检索出一行。这种处理就是所谓的转义（escaping），正则表达式内具有特殊意义的所有字符都必须以这种方式转义。

| 元字符 | 说明     |
| ------ | -------- |
| \\\f   | 换页     |
| \\\n   | 换行     |
| \\\r   | 回车     |
| \\\t   | 制表     |
| \\\v   | 纵向制表 |

> 为了匹配反斜杠（\）字符本身，需要使用\\\。



## 六、匹配字符类

- 预定义的字符集，称为字符类。

| 类           | 说明                                                |
| ------------ | --------------------------------------------------- |
| `[:alnum:]`  | 任意字母和数字（同`[a-zA-Z0-9]`）                   |
| `[:alpha:]`  | 任意字符（同`[a-zA-Z]`）                            |
| `[:blank:]`  | 空格和制表（同`[\\t]`）                             |
| `[:cntrl:]`  | `ASCII`控制字符（`ASCII` `0`到`31`和`127`）         |
| `[:digit:]`  | 任意数字（同`[0-9]`）                               |
| `[:graph:]`  | 与`[:print:]`相同，但不包括空格                     |
| `[:lower:]`  | 任意小写字母（同`[a-z]`）                           |
| `[:print:]`  | 任意可打印字符                                      |
| `[:punct:]`  | 既不在`[:alnum:]`又不在`[:cntrl:]`中的任意字符      |
| `[:space:]`  | 包括空格在内的任意空白字符（同`[\\f\\n\\r\\t\\v]`） |
| `[:upper:]`  | 任意大写字母（同`[A-Z]`）                           |
| `[:xdigit:]` | 任意十六进制数字（同`[a-fA-F0-9]`）                 |



## 七、匹配多个实例

- 重复元字符：

| 元 字 符 | 说 明                        |
| -------- | ---------------------------- |
| *        | 0个或多个匹配                |
| +        | 1个或多个匹配（等于{1,}）    |
| ?        | 0个或1个匹配（等于{0,1}）    |
| {n}      | 指定数目的匹配               |
| {n,}     | 不少于指定数目的匹配         |
| {n,m}    | 匹配数目的范围（m不超过25576 |



## 八、定位符

- 为了匹配特定位置的文本，需要使用下表列出的定位符。

| 元 字 符 | 说 明      |
| -------- | ---------- |
| ^        | 文本的开始 |
| $        | 文本的结尾 |
| [[:<:]]  | 词的开始   |
| [[:>:]]  | 词的结尾   |

