# 使用数据处理函数



## 一、函数

- 函数一般是在数据上执行的，它给数据的转换和处理提供了方便。

- 函数没有`SQL`的可移植性强 能运行在多个系统上的代码称为可移植的（`portable`）。相对来说，多数`SQL`语句是可移植的，在`SQL`实现之间有差异时，这些差异通常不那么难处理。而函数的可移植性却不强。几乎每种主要的`DBMS`的实现都支持其他实现不支持的函数，而且有时差异还很大。



## 二、使用函数

- 文本处理函数，如下例子：

```mysql
SELECT vend_name, Upper(vend_name) AS vend_upcase FROM vendors ORDER BY vend_name;
```

> `Upper()`将文本转换为大写。

- 常用的文本处理函数：

| 函数          | 说明                |
| ------------- | ------------------- |
| `Left()`      | 返回串左边的字符    |
| `Length()`    | 返回串的长度        |
| `Locate()`    | 找出串的一个子串    |
| `Lower()`     | 将串转换为小写      |
| `LTrim()`     | 去掉串左边的空格    |
| `Right()`     | 返回串右边的字符    |
| `RTrim()`     | 去掉串右边的空格    |
| `Soundex()`   | 返回串的`SOUNDEX`值 |
| `SubString()` | 返回子串的字符      |
| `Upper()`     | 将串转换为大写      |

> `SOUNDEX`是一个将任何文本串转换为描述其语音表示的字母数字模式的算法。`SOUNDEX`考虑了类似的发音字符和音节，使得能对串进行发音比较而不是字母比较。

- 使用`Soundex()`函数的例子:`customers`表中有一个顾客`Coyote Inc`.，其联系名为`Y.Lee`。但如果这是输入错误，此联系名实际应该是`Y.Lie`，

```mysql
SELECT cust_name, cust_contact FROM customers WHERE cust_contact = 'Y.Lie';
```

- 使用`Soundex()`函数进行搜索，它匹配所有发音类似于`Y.Lie`的联系名：

```mysql
SELECT cust_name, cust_contact FROM customers WHERE Soundex(cust_contact) - Soundex('Y.Lie');
```

> 在这个例子中，`WHERE`子句使用`Soundex()`函数来转换`cust_contact`列值和搜索串为它们的`SOUNDEX`值。因为`Y.Lee`和`Y.Lie`发音相似，所以它们的`SOUNDEX`值匹配，因此WHERE子句正确地过滤出了所需的数据。

- 一般，应用程序不使用用来存储日期和时间的格式，因此日期和时间函数总是被用来读取、统计和处理这些值。

| 函数            | 说明                           |
| --------------- | ------------------------------ |
| `AddDate()`     | 增加一个日期（天、周等）       |
| `AddTime()`     | 增加一个时间（时、分等）       |
| `CurDate()`     | 返回当前日期                   |
| `CurTime()`     | 返回当前时间                   |
| `Date()`        | 返回日期时间的日期部分         |
| `DateDiff()`    | 计算两个日期之差               |
| `Date_Add()`    | 高度灵活的日期运算函数         |
| `Date_Format()` | 返回一个格式化的日期或时间串   |
| `Day()`         | 返回一个日期的天数部分         |
| `DayOfWeek()`   | 对于一个日期，返回对应的星期几 |
| `Hour()`        | 返回一个时间的小时部分         |
| `Minute()`      | 返回一个时间的分钟部分         |
| `Month()`       | 返回一个日期的月份部分         |
| `Now()`         | 返回当前日期和时间             |
| Second()        | 返回一个时间的秒部分           |
| Time()          | 返回一个日期时间的时间部分     |
| Year()          | 返回一个日期的年份部分         |

> 无论你什么时候指定一个日期，不管是插入或更新表值还是用`WHERE`子句进行过滤，日期必须为格式`yyyy-mm-dd`。

- 数值处理函数仅处理数值数据。这些函数一般主要用于代数、三角或几何运算。

| 函数     | 说明               |
| -------- | ------------------ |
| `Abs()`  | 返回一个数的绝对值 |
| `Cos()`  | 返回一个角度的余弦 |
| `Exp()`  | 返回一个数的指数值 |
| `Mod()`  | 返回除操作的余数   |
| `Pi()`   | 返回圆周率         |
| `Rand()` | 返回一个随机数     |
| `Sin()`  | 返回一个角度的正弦 |
| `Sqrt()` | 返回一个数的平方根 |
| `Tan()`  | 返回一个角度的正切 |

