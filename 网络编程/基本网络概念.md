# 基本网络概念



## 一、网络

- 网络是几乎可以实时相互发送和接收数据的计算机和其他设备的集合。
- 网络中的每一个机器称为一个节点(`node`)。
  - 具有完备功能的计算机节点也称为主机(`host`)。
- 每个网络节点都有地址，这是用于唯一标识节点的一个字节序列。
- 不同的网络会以不同的方式分配地址。
  - 以太网地址与物理以太网硬件关联，且唯一。
  - Internet地址通常由负责分配地址的组织分配给计算机。

- 有些网络中节点还有可以帮助人们进行表示的名字。

> 某一时刻，一个特定的名字通常就指示一个地址，但并不与地址锁定，多对多。

- 所有现代计算机网络都是包交换（分组交换）网络：流经网络的数据分割成小块，称为包（也称分组），每个包都加以单独处理。
  - 每个包都包含了由谁发送和将发往何处的信息。
  - 多个即将交换的包可以在一条线缆上传输。
  - 分包还可以进行校验，用来检测包在传输中是否遭到破坏。



## 二、网络的分层

- 网络通信的不同方面被分解为多个层，每一层表示为物理硬件与传输信息之间的不同抽象层次。

> 将网络分层，可以修改甚至替换某一层软件，只要层与层之间的接口保存不变，就不会影响到其它层。

![image](https://github.com/ktf-cool/JavaList/blob/master/images/%E7%BD%91%E7%BB%9C%E5%88%86%E5%B1%82%E6%A8%A1%E5%9E%8B.png)

> 这个分层模型实现了应用协议与网络硬件物理特性以及网络连接拓扑结构的解耦合。

- `Internet`的标准`TCP/IP`四层模型：

![image](https://github.com/ktf-cool/JavaList/blob/master/images/%E7%BD%91%E7%BB%9C%E5%88%86%E5%B1%82.png)

> 例如:当Web浏览器向Web服务器发送获取网页的请求时，浏览器实际上只与本地客户机的传输层对话。
>
> 1. 传输层将请求分解为`TCP`片，项数据添加序列号和校验和，然后将请求传递给本地网际层。
> 2. 网际层根据本地网络所需的大小将个`TCP`片分成`IP`数据报，并传递到主机网络层以便通过线缆传输数据。
> 3. 主机网络层将数字编码为适合特定物理介质的模拟信号，将请求发送到线缆，目标地址的远程系统的主机网络层可以由此读取请求。
> 4. 远程系统的主机网络层将模拟信号解码为数字数据，将生成的`IP`数据报传递给服务器的网际层。
> 5. 网际层简单地检查`IP`数据报是否被破坏，如果已经分片则重组数据，然后传递给服务器的传输层。
> 6. 服务器的传输层检查是否所有的数据都已到达，对于丢失或破坏的部分则要求重传。
> 7. 服务器的传输层接收到足够多的连续顺序数据报，就将其重组写入一个流，有服务器应用层上运行的Web服务器读取。
> 8. 服务器响应这个请求，再通过服务器系统的各个分层发回响应，通过`Internet`进行传输并发送给`Web`客户端。

### 1.主机网络层

- 主机网络层，也称为链路层、数据链路层或网络接口层。
- 主机网络层定义了一个特定的网络接口如何通过物理连接向本地网络或世界其他地方发送`IP`数据报。

- 主机网络层中，由连接不同计算机的硬件组成的部分有时称为网络的物理层。
- 需要考虑主机网络层和物理层的主要原因是性能。

### 2.网际层

- 网际层在`OSI`模型中，网际层使用了一个更一般的名字，成为网络层。
- 网络层协议定义了数据位和字节如果组织为更大的分组，称为包，还定义寻址机制，不同计算机要按照这个寻址机制查找对方。
- 网际协议（`IP`）是世界上使用最广泛的网络层协议，也是`Java`唯一理解的网络层协议。

- 在`IPv4`和`IPv6`中，数据按包在网际层上传输，这些包称为数据报。

![image](https://github.com/ktf-cool/JavaList/blob/master/images/IPv4%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%BB%93%E6%9E%84.png)

- 除了路由和寻址，网际层的第二个作用是支持不同类型的主机网络层相互对话。网际层负责使用同构协议将异构网络相互连接。

### 3.传输层

- 传输层负责确保各包以发送的顺序接收，并确保没有数据丢失或被破坏。如果丢包，传输层会请求发送方重传这个包。
- 为了实现这个目标，`IP`网络会给每个数据报添加一个附加首部，其中包含更多信息。
- 这一层上有两个协议，第一个是传输控制协议（`TCP`），这是一个开销很高的协议，支持对丢失或破坏的数据重传，并按照发送时的顺序进行传送。
- 第二个协议是用户报协议（`UDP`），它允许接收方检测被破坏的包，但不保证这些包以正确的顺序传送（或者根本为传送）。
- `UDP`通常比`TCP`快，`TCP`称为可靠协议，`UDP`称为不可靠协议。

### 4.应用层

- 向用户传送数据的层称为应用层。
- 应用层确定了数据传输后的操作。

> 例如：应用层协议如`HTTP`可以确保`Web`浏览器将图像显示为图片，而不是一长串数字。



## 三、`IP`、`TCP` 和 `UDP`

- `IP`设计为允许任意两点之间有多个路由，可以绕过被破坏的路由器实现数据包的路由。
- `IP`必须是开放的，与平台无关。
- 由于两点间存在多个路由，并且两点间的最短路径可能由于网络业务流量获取其他因素而随时间改变，构成某个特定数据流的包可能不会采用相同的路由。另外，即使它们全部到达，也可能不会以发送的顺序到达。
- 为了改变这种基本机制，将`TCP`置于`IP`之上，使连接的两端能够确认接收到`IP`包，以及请求重传丢失或被破坏的包。此外，`TCP`允许接收端的包按发送时的顺序重新组合在一起。

- `TCP`有很大开销，如果数据的顺序不是特别重要，而且单个包的丢失不会完全破坏数据流，可以使用`UDP`发送数据包，而不需要TCP提供的保证。
- `UDP`是不可靠协议，不能保证包一定达到目的地，也不保证包会以发送时相同的顺序到达。

- 可以在应用层的`UDP`数据流中建立纠结码，来解决数据丢失问题。

### 1. `IP`地址和域名

- `IP`地址分为`IPv4`和`IPv6` 。

- 域名系统，用来将主机名转换为数字`Internet`地址。

- 有些计算机（尤其是服务器）有固定的地址，其他计算机（特别是局域网和无限连接上的客户端）可能每次启动时都会收到不同的地址，有`DHCP`服务器提供。

### 2.端口

- 每台有`IP`地址的计算机都有几千个逻辑端口（确切的讲，每个传输层协议有65535个端口），这些知识计算机内存中的抽象，不表示任何物理实物。
- 每个端口由1到65535之间的一个数字标识，每个端口可以分配给一个特定的服务。
- 当数据发送到特定`IP`地址的某个机器上的Web服务器时，它还会发送到该机器的特定端口，接收方检查接口收到的各个包，将数据发送给监听这个端口的程序。各个通信业务流就是这样区分的。

![image](https://github.com/ktf-cool/JavaList/blob/master/images/%E5%B7%B2%E7%9F%A5%E7%AB%AF%E5%8F%A3%E5%88%86%E9%85%8D.png)



## 四、Internet

- `Internet`是世界上最大的基于`IP`的网络。但不是唯一的基于`IP`的网络。其他`IP`网络称为`internet`。
- 为了确保`Internet`上不同网络中的主机可以相互通信，需要遵守一些对纯粹内部`Internet`不使用规则。最重要的是要处理不同组织、公司和个人地址的分配。

###   1. Internet地址分块

- 为了避免上述问题。区域`Internet`注册机构会为`Internet`服务提供商（`ISP`）分配`IPv4`地址块，每个地址块有固定的的前缀。

###   2. 网络地址转换

- 出于`IP`地址越来越稀缺，而对原始`IP`地址的需求越来越大，大多数络都使用了网络地址转换（`NAT`）。基于`NAT`的网络中，大多数节点只有不可路由的本地地址。
- 将本地网络连接到`ISP`的路由器会把这些本地地址转换为更小的一组可路由的地址。

- 路由器会监视出站和入站的连接，调整`IP`包中的地址。对于出站的包，它将源地址改为路由器的外部地址。对于入站的包，它将目的地址改为一个本地地址。

###   3. 防火墙

- 位于`Internet`和本地网络之间的一些硬件和软件会检查所有进出的数据，以保证其合法性，这就称为防火墙。

- 防火墙通常是将本地网络连接到更大的`Internet`的路由器的一部分，还可以完成其他任务，如网络地址转换。

- 无论采用何种方法，防火墙都要负责检查传入或传出其网络接口的各个包。根据一组规则接收或拒绝这些包。

###   4. 代理服务器

- 代理服务器与防火墙有关，如果说防火墙会阻止一个网络上的主机与外界直接建立连接，那么代理服务器就起到了中间人的作用。
- 如果防火墙阻止一个机器连接外部网络，这个机器可以请求本地代理服务器的`Web`页面，而不是直接请求远程`Web`服务器的`Web`页面。然后代理服务器会请求`Web`服务器的页面，将相应转发给最初发出请求的机器。
- 使用代理服务器的阿暖优势之一是外部主机只能看到代理服务器，而不会知道内部机器的主机名和`IP`地址，使得攻击内部网络更加困难。

- 防火墙一般工作于传输层或网际层，而代理服务器通常工作与应用层。

- 代理服务器在分层模型中的位置：

![image](https://github.com/ktf-cool/JavaList/blob/master/images/%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%A8%E5%88%86%E5%B1%82%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E4%BD%8D%E7%BD%AE.png)

- 代理服务器还可以实现本地缓存。当请求Web服务器的文件时，代理服务器首先查看此文件是否已在缓存：
  - 如果文件在缓存中，那么代理服务器将提供缓存中的文件，而不是Internet上的文件。
  - 如果这个文件不在缓存中，那么代理服务器将获取此文件，转发给请求方，并将它存储到缓存中，供下次请求使用。这种机制可以显著降低Internet连接的负载，大大提高响应时间。



## 五、客户服务器模型

- 大多数现代网络编程都基于客户/服务器模型。

- 大多数情况下，服务器主要发送数据，而客户端接收数据，很少有一个程序只发送或只接收数据。
- 更有可能的是客户端发起对话，而服务器等待客户端与它开始对话。

![image](https://github.com/ktf-cool/JavaList/blob/master/images/%E5%AE%A2%E6%88%B7%E3%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8.png)

- 不是所有引用程序都简单的符合客户/服务器模型，例如，在网络游戏中，看起来像个玩家都能大致形同地来回发送数据。这种连接成为“对等“连接。



## 六、Internet标准

- 关于应用层网络编程和协议的大多数标准都由下面两个组织制定，分别是`IETF`(`Internet`工程任务组) 和 `W3C` （国际互联网协会）。
- `IETF`是不太正式的民间团体，向所有感兴趣参与的团队开发。
- `W3C`是厂商组织，有缴纳会费的成员公司控制，明确拒绝个人参与。

