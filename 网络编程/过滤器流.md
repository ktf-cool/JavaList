# 过滤器流



## 一、过滤器流的基本介绍

- `InputStream`和`OutputStream`是相当原始的类，它们可以单个或成组的读取/写字节。
- `Java`提供了很多过滤器类，可以附加到原始流中，在原始字节和各种格式之间来回转换。

- 过滤器有两个版本：过滤器流以及阅读器和书写器。
  - 过滤器流仍然主要将原始数据作为字节处理。
  - 阅读器和书写器处理多种编码文本的特殊情况。

- 过滤器以链的形式进行组织，链中的每个环节都接收前一个过滤器或流的数据，并把数据传递给链中的下一个环节。
- 过滤器链中的数据流：

![image](https://github.com/ktf-cool/JavaList/blob/master/images/%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81.png)

- 每个过滤器输出流都有与`java.io.OutputStream`相同的`write( )`、`close()` 和 `flush( )`方法。
- 每个过滤器输入流都有与`java.io.InputStream`相同的`read( )`、`close( )` 和 `available( )` 方法。



## 二、将过滤器串链在一起

- 过滤器通过构造函数与流连接。

```java
FileputStram fin = new FileInputStream("data.txt");
BufferedInputStream bin = new BufferedInputStream(fin);
```

> 从文件`data.txt`中读取文件可能会同时使用`fin`和`bin`的`read( )` 方法。大多数情况下，应当只使用链中最后一个过滤器进行实际的读/写。

- 可以像下面这样重写底层输入流的引用：

```java
FileputStram in = new FileInputStream("data.txt");
in = new BufferedInputStream(in);  //多态的写法
```

> 执行这两行代码后，没有任何方法能访问底层的文件输入流了。

- 如果必须使用超类中没有声明的过滤器的其他方法，可以直接在一个流中直接构建另一个流。

```java
DataOutputStream dout = new DataOutputStream(
    					new BufferedOutputStream(
        				new FileOutputStream("data.txt")
                       )
					);
```



## 三、缓冲流

- `BufferedOutputStream`类将写入的数据存储在缓冲区中（一个名为`buf`的保护字节数组字段），直到缓冲区满或刷新输出流。

> 它将数据一次全部写入底层输出流。如果一次写入多字节比多次写入少字节要快得多。

- `BufferedInputStream`类也有一个作为缓冲区的保护字节数组，名为`buf`。

> 当调用某个流的read( ) 方法时，它首先尝试从缓冲区获取请求的数据。只有当缓冲区没有数据时，流才从底层的源中读取数据。这时，它会从源中读取尽可能多的数据存入缓冲区，而不管是否马上需要这些数据。

- `BufferedOutputStream`和`BufferedInputStream`都有两个构造函数：

```java
public BufferedInputStream(InputStream in)
public BufferedInputStream(InputStream in, int bufferSize)
public BufferedOutputStream(InputStream out)
public BufferedOutputStream(InputStream out, int bufferSize)
```

> 第一个参数是底层流，可以从中读取未缓冲的数据，或者向其写入缓冲的数据。
>
> 如果给出第二个参数，它会指定缓冲区中的字节数。否则，输入流的缓冲区大小设置为2048字节，输出流的缓冲区大小设置为512字节。

- `BufferedInputStream`没有声明自己的任何新方法。只覆盖了`InputStream`的方法。

- `BufferedOutputStream`也没有声明自己的任何新方法。调用它的方法与调用 任何输出流的方法是一样的。区别在于，每次写入会把数据放在缓冲区中，而不是直接放入底层的输出流。发送数据时应该刷新输出流。



## 四、`PrintStream`

- `PrintStream`类是一个过滤器输出流，可以使用下面两个构造函数将其他输出流串链到打印流：

```java
public PrintStream(OutputStream out)
public PrintStream(OutputStream out, boolean autoFlush)
```

> 默认情况下，打印流应当显式刷新输出，如果`autoFlush`参数为`true`，那么每次写入1字节数组或换行，或者调用`println( )` 方法，都会刷新输出流。

- `PrintStream`是有害的，网络程序员应该避开它。
  - `println( )` 的输出是与平台有关的，取决于运算代码的机器。
  - `PrintStream`假定使用所在平台的默认编码方式。
  - `PrintStream`吞掉了所有异常。



## 五、数据流

- `DataInputStream`和`DataOutputStream`类提供了一些方法，可以用二进制格式读写Java的基本数据类型和字符串。

- `DataInputStream`和`DataOutputStream`是互补的，`DataOutputStream`写入的每一种格式，`DataInputStream`都可以读取。
